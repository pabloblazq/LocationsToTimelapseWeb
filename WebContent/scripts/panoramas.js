//Prevent forms from submitting.
//function preventFormSubmit() {
//	var forms = document.querySelectorAll('form');
//	for (var i = 0; i < forms.length; i++) {
//		forms[i].addEventListener('submit', function(event) {
//			event.preventDefault();
//		});
//	}
//}
//window.addEventListener('load', preventFormSubmit);

function getRoute(markers) {
	var origin = {
			"lat" : markers[0].getPosition().lat(),
			"lng" : markers[0].getPosition().lng()
	}
	var destination = {
			"lat" : markers[1].getPosition().lat(),
			"lng" : markers[1].getPosition().lng()
	}
	google.script.run.withSuccessHandler(onSuccessGetRouteForLocations).getRouteForLocations(origin, destination);
}

function onSuccessGetRouteForLocations(route) {
	console.log(route);
	setStepMarkers(route);
	google.script.run.withSuccessHandler(onSuccessPopulateWithPanoramas).populateWithPanoramas(route);
}

function onSuccessPopulateWithPanoramas(route) {
	var continueNextStep = setPanoramaMarkers(route);
	if(continueNextStep) {
		google.script.run.withSuccessHandler(onSuccessPopulateWithPanoramas).populateWithPanoramas(route);
	}
	else {
		console.log(route);
		//TODO: get panorama images step by step, and updating the markers icons (need to place the marker inside each panorama object)
	}
}

var globalPanoramas;
var panoramaIndex;
var timer;

function onSuccessExtractPanoramasFromRoute(panoramas) {
	globalPanoramas = panoramas;
	panoramaIndex = 0;
	//timer = setInterval(getNextImage, 1000);
}

function getNextImage() {
	var panorama = globalPanoramas[panoramaIndex++];
	google.script.run.withSuccessHandler(onSuccessGetImageForPanorama).getImageForPanoramaBase64(panorama.panoId, panorama.direction);
}

function createObjectURL(object) {
	return (window.URL) ? window.URL.createObjectURL(object) : window.webkitURL.createObjectURL(object);
}

function onSuccessGetImageForPanorama(imageBase64) {
	var elem = document.createElement("img");
	//elem.setAttribute("src", "data:image/jpeg;base64,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");
	elem.setAttribute("src", "data:image/jpeg;base64," + imageBase64);
	elem.setAttribute("width", "640");
	elem.setAttribute("height", "360");
	var div = document.getElementById('show-panorama-image');
	div.removeChild(div.childNodes[0]);
	div.appendChild(elem);
}
